<div class="row certificate_picker">
    <label class="control-label col-sm-3">{{ certificate.label }}</label>
    <div class="col-sm-8 col-xs-10">
        <select class="selectpicker " data-live-search="true"
                name="{{ certificate.name }}"
                id="id_{{ certificate.name }}" data-show-subtext="True">
            {% if certificate.value == None or certificate.value == '-1' %}
                <option value="-1" selected>Nothing selected!</option>
            {% endif %}
            {% for choise in certificate.field.queryset %}
                <option value="{{ choise.id }}"
                        {% if certificate.value|slugify == choise.id|slugify %}
                        selected{% endif %}
                        data-subtext="{{ choise }}">{{ choise.subject.cname }}</option>
            {% endfor %}
        </select>
        {% include "connections/forms/../widgets/errormsg.html" with field=certificate %}
    </div>
    <div class="col-sm-1 col-xs-2">
        {% include "connections/widgets/QuestionPopover.html" with title="User certificate help" content="Select a certificate which authenticates yourself. Only certificate with a private key are shown." %}
    </div>
</div>
<div class="row identity_picker">
    <label class="control-label col-sm-3">{{ identity.label }}</label>
    <div class="col-sm-8 col-xs-10">
        <select class="selectpicker" data-live-search="true" name="{{ identity.name }}"
                id="id_{{ identity.name }}" data-show-subtext="True"
                {% if identity.field.choices|length == 0 %}disabled="True"{% endif %}>
            {% for value, identity_choice in identity.field.choices %}
                <option value="{{ value }}"
                        {% if identity.value|slugify == value|slugify %}selected={% endif %}
                                data-subtext="{{ identity_choice.type }}"
                                   {% if not identity.value and identity_choice.type == 'distinguishedName' %}
                        selected
                    {% endif %}>{{ identity_choice }}
                </option>
            {% endfor %}

        </select>
        {% include "connections/forms/../widgets/errormsg.html" with field=identity %}
    </div>
    <div class="col-sm-1 col-xs-2">
        {% include "connections/widgets/QuestionPopover.html" with title="Identity help" content="Select one of the available identities. Use the distinguishedName in doubt. This field will be enabled as soon as the certificate is selected." %}
    </div>
</div>
<script>
    var previous = null;
    var div = $(".certificate_picker");
    var select = div.find("select")

    div.mouseenter(function (e) {
        // Store the current value on focus and on change
        var myselect = $(this).find("select")
        previous = myselect[0].value;
    });
    select.change(function () {
        // Make sure the previous value is updated
        previous = this.value;
        form = $(this).closest("form");
        form.find("#refresh_choices").val("True");
        form.submit();
    });
</script>